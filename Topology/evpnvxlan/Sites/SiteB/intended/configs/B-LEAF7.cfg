!RANCID-CONTENT-TYPE: arista
!
daemon TerminAttr
   exec /usr/bin/TerminAttr -cvaddr=172.100.100.5:9910 -cvauth=token,/tmp/token -smashexcludes=ale,flexCounter,hardware,kni,pulse,strata -ingestexclude=/Sysdb/cell/1/agent,/Sysdb/cell/2/agent -taillogs
   no shutdown
!
vlan internal order ascending range 1006 1199
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname B-LEAF7
ip name-server vrf default 8.8.4.4
ip name-server vrf default 8.8.8.8
dns domain lab.lab
!
ntp server 0.north-america.pool.ntp.org prefer
ntp server 1.north-america.pool.ntp.org
!
aaa authorization exec default local
!
no enable password
no aaa root
!
username arista privilege 15 role network-admin secret sha512 $6$ZGX/X07MoiWP9hvX$3UaAtOAiBGc54DYHdQt5dsr5P2HLydxjrda51Zw69tSsF4tahXPVj26PwOiZUy/xFRZL3CAkT7.lsOPqWfIbU0
username cvpadmin privilege 15 role network-admin secret sha512 $6$vQGQxmJp16IINuqk$makfRsxIS8Das8bugela5cdUd0iSUzA0/nPRXWXmonGeQ/vuqWi.vrr1OINH4MZLCOux0tniArjvyJNJHe9Zt.
username ec2-user shell /bin/bash nopassword
username ec2-user ssh-key ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDxTxvxMJkL/JFZ8dHFkeHb4r+E8JQ7ScqU/TRO1cBhQd98sZMuazglCSQNzOriRs9AdwZ2HdCz741HTIH7uIU7wRBfCyCHThy/FS66vvP42rMyV+/v2VuU0u6eylZg2fERjHKHpu0HYFZvlR/dxa1uNBGDGXvfXmAwBLlrV1aNXgmiejoCYpupGLu20OWQac2tYUwiVS7vNSCMEvHCTUQ/HITEn5xXhxyP/xVYIX4rXwKQdPogWc2pdJMvNt75VvIdunEthf5ZotPBq923Hvn474199W+Wp0AEPyh/JidRQSRM/X5VA1Yhj8umt8APg6RW1hvco6JwMEM6MUZN0dyvm18S35FRlsFtpypY2s8DFrIgEMf8uQxBz98wDt3aAiHiVK7zxOOrRgvibJuZYy1ZRNlOiMwGyl8ZHhSJO5HHXWVTi1YOwf0Nu/WB37KJbdc50lj0iCygPIP+X4UfIoyb+KHx4PNAC/G/+D/gxfs848QMhp2aZHvixzkGYtx0KfE= root@buildkitsandbox
username service shell /bin/bash secret sha512 $6$87aMed0EkMv1qiNN$3nKVoCOnYY7LXNcvJnyqJTt2QeODvm61.mYNU/PiTs4WFtVWyZ.IneelQQEyHiqYEUoLgStcfjXqWo2Cx697/1
!
clock timezone EST
!
vlan 10
   name Blue
!
vlan 20
   name Green
!
vlan 60
   name Red
!
vlan 70
   name Brown
!
vrf instance DEV
!
vrf instance PROD
!
link tracking group ES-LINKS
   recovery delay 300
!
interface Ethernet1
   description P2P_LINK_TO_B-SPINE1_Ethernet7
   no shutdown
   mtu 1500
   no switchport
   ip address 9.9.9.49/31
   link tracking group ES-LINKS upstream
!
interface Ethernet2
   description P2P_LINK_TO_B-SPINE2_Ethernet7
   no shutdown
   mtu 1500
   no switchport
   ip address 9.9.9.51/31
   link tracking group ES-LINKS upstream
!
interface Ethernet3
   description P2P_LINK_TO_B-SPINE3_Ethernet7
   no shutdown
   mtu 1500
   no switchport
   ip address 9.9.9.53/31
   link tracking group ES-LINKS upstream
!
interface Ethernet4
   description P2P_LINK_TO_B-SPINE4_Ethernet7
   no shutdown
   mtu 1500
   no switchport
   ip address 9.9.9.55/31
   link tracking group ES-LINKS upstream
!
interface Ethernet7
   description P2P_LINK_TO_BB1_Ethernet3
   no shutdown
   mtu 1500
   no switchport
   ip address 172.16.2.1/31
!
interface Ethernet8
   description P2P_LINK_TO_BB2_Ethernet3
   no shutdown
   mtu 1500
   no switchport
   ip address 172.16.2.5/31
!
interface Loopback0
   description EVPN_Overlay_Peering
   no shutdown
   ip address 10.0.0.27/32
!
interface Loopback1
   description VTEP_VXLAN_Tunnel_Source
   no shutdown
   ip address 10.2.2.27/32
!
interface Management1
   description oob_management
   no shutdown
   ip address 172.100.100.124/24
!
interface Vlan10
   description Blue
   no shutdown
   vrf PROD
   ip address virtual 10.10.10.1/24
!
interface Vlan20
   description Green
   no shutdown
   vrf PROD
   ip address virtual 10.20.20.1/24
!
interface Vlan60
   description Red
   no shutdown
   vrf DEV
   ip address virtual 10.60.60.1/24
!
interface Vlan70
   description Brown
   no shutdown
   vrf DEV
   ip address virtual 10.70.70.1/24
!
interface Vxlan1
   description B-LEAF7_VTEP
   vxlan source-interface Loopback1
   vxlan udp-port 4789
   vxlan vlan 10 vni 10010
   vxlan vlan 20 vni 10020
   vxlan vlan 60 vni 10060
   vxlan vlan 70 vni 10070
   vxlan vrf DEV vni 50002
   vxlan vrf PROD vni 50001
!
ip virtual-router mac-address 00:1c:73:00:00:01
!
ip routing
ip routing vrf DEV
ip routing vrf PROD
!
ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
   seq 10 permit 10.0.0.0/24 eq 32
   seq 20 permit 10.2.2.0/24 eq 32
!
route-map RM-CONN-2-BGP permit 10
   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
!
router bfd
   multihop interval 1200 min-rx 1200 multiplier 3
!
router bgp 65200
   router-id 10.0.0.27
   distance bgp 20 200 200
   graceful-restart restart-time 300
   graceful-restart
   maximum-paths 4 ecmp 4
   no bgp default ipv4-unicast
   neighbor EVPN-OVERLAY-CORE peer group
   neighbor EVPN-OVERLAY-CORE update-source Loopback0
   neighbor EVPN-OVERLAY-CORE bfd
   neighbor EVPN-OVERLAY-CORE ebgp-multihop 15
   neighbor EVPN-OVERLAY-CORE send-community
   neighbor EVPN-OVERLAY-CORE maximum-routes 0
   neighbor EVPN-OVERLAY-PEERS peer group
   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
   neighbor EVPN-OVERLAY-PEERS bfd
   neighbor EVPN-OVERLAY-PEERS ebgp-multihop 3
   neighbor EVPN-OVERLAY-PEERS send-community
   neighbor EVPN-OVERLAY-PEERS maximum-routes 0
   neighbor IPv4-UNDERLAY-PEERS peer group
   neighbor IPv4-UNDERLAY-PEERS send-community
   neighbor IPv4-UNDERLAY-PEERS maximum-routes 12000
   neighbor REMOTE-IPV4-PEERS peer group
   neighbor REMOTE-IPV4-PEERS remote-as 65000
   neighbor REMOTE-IPV4-PEERS bfd
   neighbor 9.9.9.48 peer group IPv4-UNDERLAY-PEERS
   neighbor 9.9.9.48 remote-as 65200
   neighbor 9.9.9.48 description B-SPINE1_Ethernet7
   neighbor 9.9.9.50 peer group IPv4-UNDERLAY-PEERS
   neighbor 9.9.9.50 remote-as 65200
   neighbor 9.9.9.50 description B-SPINE2_Ethernet7
   neighbor 9.9.9.52 peer group IPv4-UNDERLAY-PEERS
   neighbor 9.9.9.52 remote-as 65200
   neighbor 9.9.9.52 description B-SPINE3_Ethernet7
   neighbor 9.9.9.54 peer group IPv4-UNDERLAY-PEERS
   neighbor 9.9.9.54 remote-as 65200
   neighbor 9.9.9.54 description B-SPINE4_Ethernet7
   neighbor 10.0.0.121 peer group EVPN-OVERLAY-PEERS
   neighbor 10.0.0.121 remote-as 65200
   neighbor 10.0.0.121 description B-SPINE1
   neighbor 10.0.0.122 peer group EVPN-OVERLAY-PEERS
   neighbor 10.0.0.122 remote-as 65200
   neighbor 10.0.0.122 description B-SPINE2
   neighbor 10.0.0.123 peer group EVPN-OVERLAY-PEERS
   neighbor 10.0.0.123 remote-as 65200
   neighbor 10.0.0.123 description B-SPINE3
   neighbor 10.0.0.124 peer group EVPN-OVERLAY-PEERS
   neighbor 10.0.0.124 remote-as 65200
   neighbor 10.0.0.124 description B-SPINE4
   neighbor 172.16.0.1 peer group EVPN-OVERLAY-CORE
   neighbor 172.16.0.1 remote-as 65000
   neighbor 172.16.0.1 description BB1
   neighbor 172.16.0.2 peer group EVPN-OVERLAY-CORE
   neighbor 172.16.0.2 remote-as 65000
   neighbor 172.16.0.2 description BB2
   neighbor 172.16.2.0 peer group REMOTE-IPV4-PEERS
   neighbor 172.16.2.4 peer group REMOTE-IPV4-PEERS
   redistribute connected route-map RM-CONN-2-BGP
   !
   vlan 10
      rd 10.0.0.27:10010
      rd evpn domain remote 10.0.0.27:10010
      route-target both 10010:10010
      route-target import export evpn domain remote 10010:10010
      redistribute learned
   !
   vlan 20
      rd 10.0.0.27:10020
      rd evpn domain remote 10.0.0.27:10020
      route-target both 10020:10020
      route-target import export evpn domain remote 10020:10020
      redistribute learned
   !
   vlan 60
      rd 10.0.0.27:10060
      rd evpn domain remote 10.0.0.27:10060
      route-target both 10060:10060
      route-target import export evpn domain remote 10060:10060
      redistribute learned
   !
   vlan 70
      rd 10.0.0.27:10070
      rd evpn domain remote 10.0.0.27:10070
      route-target both 10070:10070
      route-target import export evpn domain remote 10070:10070
      redistribute learned
   !
   address-family evpn
      neighbor EVPN-OVERLAY-CORE activate
      neighbor EVPN-OVERLAY-CORE domain remote
      neighbor EVPN-OVERLAY-PEERS activate
      neighbor default next-hop-self received-evpn-routes route-type ip-prefix inter-domain
   !
   address-family ipv4
      no neighbor EVPN-OVERLAY-CORE activate
      no neighbor EVPN-OVERLAY-PEERS activate
      neighbor IPv4-UNDERLAY-PEERS activate
      neighbor REMOTE-IPV4-PEERS activate
      network 10.0.0.27/32
      network 10.0.0.28/32
      network 10.2.2.27/32
   !
   vrf DEV
      rd 10.0.0.27:50002
      route-target import evpn 50002:50002
      route-target export evpn 50002:50002
      router-id 10.0.0.27
      redistribute connected
   !
   vrf PROD
      rd 10.0.0.27:50001
      route-target import evpn 50001:50001
      route-target export evpn 50001:50001
      router-id 10.0.0.27
      redistribute connected
!
management api http-commands
   protocol https
   no shutdown
   !
   vrf default
      no shutdown
!
agent KernelFib environment KERNELFIB_PROGRAM_ALL_ECMP='true'

!
end
